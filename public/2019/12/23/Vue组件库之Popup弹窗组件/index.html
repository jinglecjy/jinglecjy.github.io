<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="前端"><title>vue组件库之popup弹窗组件 | Winnie Cai's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">vue组件库之popup弹窗组件</h1><a id="logo" href="/.">Winnie Cai's Blog</a><p class="description">生气了，一顿饭哄不好的那种。恩，要两顿。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">vue组件库之popup弹窗组件</h1><div class="post-meta">Dec 23, 2019<span> | </span><span class="category"><a href="/categories/vue组件/">vue组件</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#需求背景"><span class="toc-number">1.</span> <span class="toc-text">需求背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#滑动穿透问题"><span class="toc-number">3.</span> <span class="toc-text">滑动穿透问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#初始的解决方案"><span class="toc-number">3.1.</span> <span class="toc-text">初始的解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用库实现"><span class="toc-number">3.2.</span> <span class="toc-text">使用库实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PC端"><span class="toc-number">3.2.1.</span> <span class="toc-text">PC端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Android端"><span class="toc-number">3.2.2.</span> <span class="toc-text">Android端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iOS端"><span class="toc-number">3.2.3.</span> <span class="toc-text">iOS端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ui组件库都是怎么实现的？"><span class="toc-number">3.3.</span> <span class="toc-text">ui组件库都是怎么实现的？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多弹窗层级问题"><span class="toc-number">4.</span> <span class="toc-text">多弹窗层级问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展"><span class="toc-number">5.</span> <span class="toc-text">扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><h2 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h2><p>在做活动页面时经常需要实现各种各样的弹窗，有一些常见的问题需要处理，包含：   </p>
<ul>
<li>滑动穿透问题：滑动上层元素导致底层元素滚动</li>
<li>多弹窗层级问题：当有多弹窗时，最新的弹窗永远在最上层    </li>
<li>出现/消失过渡动画</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>已发布npm包欢迎使用反馈和star~<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install </span><span class="keyword">jdc-popup </span>-S</span><br></pre></td></tr></table></figure></p>
<p>github: <a href="https://github.com/winniecjy/jdc-popup" target="_blank" rel="noopener">https://github.com/winniecjy/jdc-popup</a><br>demo: <a href="https://winniecjy.github.io/jdc-popup/demo/" target="_blank" rel="noopener">https://winniecjy.github.io/jdc-popup/demo/</a><br><img src="https://img11.360buyimg.com/imagetools/s200x200_jfs/t1/91021/5/7943/23039/5e00255bE34ea4ce4/da97ea669a8ccd64.png" alt></p>
<h2 id="滑动穿透问题"><a href="#滑动穿透问题" class="headerlink" title="滑动穿透问题"></a>滑动穿透问题</h2><h3 id="初始的解决方案"><a href="#初始的解决方案" class="headerlink" title="初始的解决方案"></a>初始的解决方案</h3><p>打开浮层时fixed底部元素，同时为了保持body的位置与打开浮层前一致，设置top偏移为当前scrollTop；<br>关闭浮层时恢复底部元素状态和滚动高度；<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">controlledBgScrolled() &#123;</span><br><span class="line">    <span class="keyword">let</span> bgEle = <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>);</span><br><span class="line">    <span class="comment">// 打开浮层</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.showPopup) &#123;</span><br><span class="line">        <span class="keyword">let</span> top = <span class="built_in">document</span>.documentElement.scrollTop</span><br><span class="line">          || <span class="built_in">window</span>.pageYOffset</span><br><span class="line">          || <span class="built_in">document</span>.body.scrollTop;</span><br><span class="line">        <span class="keyword">this</span>.scrollTop = top;</span><br><span class="line">        bgEle.style.position = <span class="string">'fixed'</span>;</span><br><span class="line">        bgEle.style.top = <span class="string">`-<span class="subst">$&#123;top&#125;</span>px`</span>;</span><br><span class="line">        bgEle.style.height = <span class="string">'100%'</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        bgEle.style.position = <span class="string">'relative'</span>;</span><br><span class="line">        bgEle.style.top = <span class="string">''</span>;</span><br><span class="line">        bgEle.style.height = <span class="string">'100%'</span>;</span><br><span class="line">        <span class="built_in">document</span>.documentElement.scrollTop = <span class="keyword">this</span>.scrollTop; </span><br><span class="line">        <span class="built_in">window</span>.pageYOffset = <span class="keyword">this</span>.scrollTop;</span><br><span class="line">        <span class="built_in">document</span>.body.scrollTop = <span class="keyword">this</span>.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个方案的缺点是：   </p>
<ol>
<li>打开/关闭弹层瞬间，可以看到有闪动</li>
<li>由于是APP内嵌页面，当设置APP沉浸式状态栏有几率发生冲突</li>
</ol>
<h3 id="使用库实现"><a href="#使用库实现" class="headerlink" title="使用库实现"></a>使用库实现</h3><p>测试提出bug的时间比较紧急，所以直接引入了npm包<a href="#ref1">tua-scroll-body-lock</a>解决了该问题，经过测试，ios8+，android4.4+下没有发现问题。<br>库的源码比较清晰，有兴趣的同学可以看一下：<a href="https://github.com/tuateam/tua-body-scroll-lock/tree/master/src" target="_blank" rel="noopener">https://github.com/tuateam/tua-body-scroll-lock/tree/master/src</a><br>之前的个人的思路都是想要一套代码兼容各端，这个库是将问题细分，对不同端进行了不同的处理，更容易去兼容。据官方描述，这三种方案都无法完美兼容所有端，详细可以查看<a href="#ref2">[2]</a>。             </p>
<h4 id="PC端"><a href="#PC端" class="headerlink" title="PC端"></a>PC端</h4><p>PC端实现比较简单，通过在body设置<code>overflow: hidden</code>就OK了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $body = <span class="built_in">document</span>.querySelector(<span class="string">'body'</span>)</span><br><span class="line"><span class="keyword">const</span> bodyStyle = &#123; ...$body.style &#125;</span><br><span class="line"><span class="keyword">const</span> scrollBarWidth = <span class="built_in">window</span>.innerWidth - <span class="built_in">document</span>.body.clientWidth</span><br><span class="line"><span class="comment">// 打开浮层时</span></span><br><span class="line">$body.style.overflow = <span class="string">'hidden'</span></span><br><span class="line">$body.style.boxSizing = <span class="string">'border-box'</span></span><br><span class="line">$body.style.paddingRight = <span class="string">`<span class="subst">$&#123;scrollBarWidth&#125;</span>px`</span></span><br><span class="line"><span class="comment">// 关闭浮层时，恢复原始设置</span></span><br><span class="line">[<span class="string">'overflow'</span>, <span class="string">'boxSizing'</span>, <span class="string">'paddingRight'</span>]</span><br><span class="line">.forEach(<span class="function">(<span class="params">x: OverflowHiddenPcStyleType</span>) =&gt;</span> &#123;</span><br><span class="line">    $body.style[x] = bodyStyle[x] || <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Android端"><a href="#Android端" class="headerlink" title="Android端"></a>Android端</h4><p>Android端的实现与个人的方案思路基本一致，打开弹层时将底部元素fixed并设置top偏移，关闭浮层时恢复现场，注意到底部元素必须同时设置html和body。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scrollTop = $html.scrollTop || $body.scrollTop</span><br><span class="line"><span class="keyword">const</span> htmlStyle = &#123; ...$html.style &#125;</span><br><span class="line"><span class="keyword">const</span> bodyStyle = &#123; ...$body.style &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开浮层时，fixed底部</span></span><br><span class="line">$html.style.height = <span class="string">'100%'</span></span><br><span class="line">$html.style.overflow = <span class="string">'hidden'</span></span><br><span class="line">$body.style.top = <span class="string">`-<span class="subst">$&#123;scrollTop&#125;</span>px`</span></span><br><span class="line">$body.style.width = <span class="string">'100%'</span></span><br><span class="line">$body.style.height = <span class="string">'auto'</span></span><br><span class="line">$body.style.position = <span class="string">'fixed'</span></span><br><span class="line">$body.style.overflow = <span class="string">'hidden'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭浮层时，恢复现场</span></span><br><span class="line">$html.style.height = htmlStyle.height || <span class="string">''</span></span><br><span class="line">$html.style.overflow = htmlStyle.overflow || <span class="string">''</span></span><br><span class="line">[<span class="string">'top'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'overflow'</span>, <span class="string">'position'</span>]</span><br><span class="line">.forEach(<span class="function">(<span class="params">x: OverflowHiddenMobileStyleType</span>) =&gt;</span> &#123;</span><br><span class="line">  $body.style[x] = bodyStyle[x] || <span class="string">''</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.scrollTo(<span class="number">0</span>, scrollTop)</span><br></pre></td></tr></table></figure></p>
<h4 id="iOS端"><a href="#iOS端" class="headerlink" title="iOS端"></a>iOS端</h4><p>iOS端在打开浮层时，禁用了底部的<code>touchmove</code>事件，如果弹窗内部元素需要可滚动，则通过另外的函数自行处理。关闭浮层时移除所有事件监听。经测试，该方案在Android下弹窗滚动到边界时，底部元素有几率出现滚动。该库在iPhone 6p下初次打开无法滚动。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***  打开浮层时,处理浮层和底部元素的滚动事件 ***/</span></span><br><span class="line"><span class="comment">// 1. targetElement为需要滚动的元素容器，处理其滚动</span></span><br><span class="line"><span class="keyword">if</span> (targetElement &amp;&amp; lockedElements.indexOf(targetElement) === <span class="number">-1</span>) &#123;</span><br><span class="line">    targetElement.ontouchstart = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        initialClientY = event.targetTouches[<span class="number">0</span>].clientY</span><br><span class="line">    &#125;</span><br><span class="line">    targetElement.ontouchmove = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.targetTouches.length !== <span class="number">1</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// 手动处理滚动</span></span><br><span class="line">        handleScroll(event, targetElement)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 记录可滚动元素</span></span><br><span class="line">    lockedElements.push(targetElement)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> handleScroll = <span class="function">(<span class="params">event, targetElement</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clientY = event.targetTouches[<span class="number">0</span>].clientY - initialClientY</span><br><span class="line">    <span class="keyword">if</span> (targetElement) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; scrollTop, scrollHeight, clientHeight &#125; = targetElement</span><br><span class="line">        <span class="comment">// 向上滚动时 且 已经到达顶部</span></span><br><span class="line">        <span class="keyword">const</span> isOnTop = clientY &gt; <span class="number">0</span> &amp;&amp; scrollTop === <span class="number">0</span></span><br><span class="line">        <span class="comment">// 当向下滚动 且 已经到达底部</span></span><br><span class="line">        <span class="keyword">const</span> isOnBottom = clientY &lt; <span class="number">0</span></span><br><span class="line">                          &amp;&amp; scrollTop + clientHeight + <span class="number">1</span> &gt;= scrollHeight</span><br><span class="line">        <span class="keyword">if</span> (isOnTop || isOnBottom) &#123;</span><br><span class="line">            <span class="keyword">return</span> preventDefault(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    event.stopPropagation()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 禁止document的touchMove事件</span></span><br><span class="line"><span class="keyword">if</span> (!documentListenerAdded) &#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(</span><br><span class="line">      <span class="string">'touchmove'</span>,</span><br><span class="line">      preventDefault,</span><br><span class="line">      eventListenerOptions)</span><br><span class="line">    documentListenerAdded = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/***  关闭浮层时，移除时间监听 ***/</span></span><br><span class="line"><span class="keyword">if</span> (targetElement) &#123;</span><br><span class="line">    <span class="keyword">const</span> index = lockedElements.indexOf(targetElement)</span><br><span class="line">    <span class="keyword">if</span> (index !== <span class="number">-1</span>) &#123;</span><br><span class="line">        targetElement.ontouchmove = <span class="literal">null</span></span><br><span class="line">        targetElement.ontouchstart = <span class="literal">null</span></span><br><span class="line">        lockedElements.splice(index, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (documentListenerAdded) &#123;</span><br><span class="line">    <span class="built_in">document</span>.removeEventListener(</span><br><span class="line">      <span class="string">'touchmove'</span>,</span><br><span class="line">      preventDefault,</span><br><span class="line">      eventListenerOptions)</span><br><span class="line">    documentListenerAdded = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ui组件库都是怎么实现的？"><a href="#ui组件库都是怎么实现的？" class="headerlink" title="ui组件库都是怎么实现的？"></a>ui组件库都是怎么实现的？</h3><p>用库可以较好的完成这个需求，但是对于滑动穿透这样的小问题，每次都引入库解决有点小题大做。基于上述考虑，选取了京东的nutui/有赞的vant/饿了么的mintui对比其实现方案，对比如下：       </p>
<table>
<thead>
<tr>
<th>组件库</th>
<th>实现思路</th>
<th>实现形式</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/youzan/vant/blob/dev/src/mixins/popup/index.js" target="_blank" rel="noopener">vant</a></td>
<td>touch事件处理</td>
<td>mixins，抽取了复杂复用逻辑</td>
</tr>
<tr>
<td><a href="https://github.com/ElemeFE/mint-ui/tree/master/src/utils/popup" target="_blank" rel="noopener">mint</a></td>
<td>touch事件处理</td>
<td>mixins，抽取了复杂逻辑，但实现方案上依赖组件结构，复用性不强</td>
</tr>
<tr>
<td><a href="https://github.com/jdf2e/nutui/blob/master/src/packages/dialog/dialog.vue" target="_blank" rel="noopener">nut</a></td>
<td>fixed底层背景</td>
<td>组件内部函数，简洁易读，复用性不强</td>
</tr>
</tbody>
</table>
<p>对比了一下三个方案，并实际测试（iOS8+/Android4+），还是无法兼容所有机型，最终的还是按照库的基本思路包装了一下组件。<br>另外加入overscroll-behavior虽然兼容性不佳，但是安卓原生浏览器和chrome浏览器仍然有部分支持。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于半透明蒙层阻止滚动</span></span><br><span class="line">mask.addEventListener(</span><br><span class="line">  <span class="string">'touchmove'</span>, </span><br><span class="line">  <span class="keyword">this</span>.preventDefault,</span><br><span class="line">  &#123; <span class="attr">capture</span>: <span class="literal">false</span>, <span class="attr">passive</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 对可滚动元素容器手动处理滚动</span></span><br><span class="line">onTouchMove(event, targetElement) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (targetElement) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            scrollTop,</span><br><span class="line">            scrollHeight,</span><br><span class="line">            clientHeight</span><br><span class="line">        &#125; = targetElement</span><br><span class="line">        <span class="comment">// 向上滚动时 且 已经到达顶部</span></span><br><span class="line">        <span class="keyword">const</span> isOnTop = <span class="keyword">this</span>.deltaY &gt; <span class="number">0</span> &amp;&amp; scrollTop === <span class="number">0</span></span><br><span class="line">        <span class="comment">// 当向下滚动 且 已经到达底部</span></span><br><span class="line">        <span class="keyword">const</span> isOnBottom = <span class="keyword">this</span>.deltaY &lt; <span class="number">0</span></span><br><span class="line">                          &amp;&amp; scrollTop + clientHeight + <span class="number">1</span> &gt;= scrollHeight</span><br><span class="line">        <span class="keyword">if</span> (isOnTop || isOnBottom) &#123;</span><br><span class="line">            <span class="keyword">this</span>.preventDefault(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    event.stopPropagation()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭弹窗时，移除所有事件</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h2 id="多弹窗层级问题"><a href="#多弹窗层级问题" class="headerlink" title="多弹窗层级问题"></a>多弹窗层级问题</h2><p>当前后打开两个弹窗，用户的预期是按照打开的先后顺序，越后打开的弹窗在越上层，简而言之就是新弹窗永远在最上层。可以通过记录当前出现过的最大zIndex，新弹窗<code>zIndex = zIndex+1</code>。 另外滑动穿透问题在多弹窗情况下也需要处理，对于非当前最高层级弹窗，不应当收到滚动影响。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$el.style.zIndex = context.zIndex + <span class="number">1</span>; </span><br><span class="line">context.zIndex += <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>业务上的弹窗样式一般比较复杂，如果只是简单通用的弹窗样式，想要解决滑动穿透问题，可以通过<code>Vue.extend</code>扩展，将弹窗组件直接挂载到document下（element-ui中就使用了类似的做法），不会和主体内容互相影响，调用起来也更加灵活。   </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="ref1"><a href="https://tuateam.github.io/tua-body-scroll-lock/" target="_blank" rel="noopener">[1] tua-scroll-body-lock</a></a><br><a href="ref2"><a href="https://juejin.im/post/5ca4816e5188250b251e34e9" target="_blank" rel="noopener">[2] 滑动穿透(锁body)终极探索</a></a><br><a href="https://blog.csdn.net/riddle1981/article/details/102659958" target="_blank" rel="noopener">[3] vant-popup</a><br><a href="https://github.com/jdf2e/nutui" target="_blank" rel="noopener">[4] NUTUI</a>   </p>
</div><div class="tags"><a href="/tags/vue/">vue</a><a href="/tags/组件沉淀/">组件沉淀</a></div><div class="post-nav"><a class="pre" href="/2020/02/06/初识AI之设计稿楼层识别分割/">初识AI之设计稿楼层识别分割</a><a class="next" href="/2019/12/19/算法应用之自定义公式计算/">算法应用之自定义公式计算</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/intensive-study/">intensive study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lesson/">lesson</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/notes/">notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/review/">review</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue组件/">vue组件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/weekly/">weekly</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/threejs/" style="font-size: 15px;">threejs</a> <a href="/tags/周报/" style="font-size: 15px;">周报</a> <a href="/tags/数据分析工具项目/" style="font-size: 15px;">数据分析工具项目</a> <a href="/tags/项目复盘/" style="font-size: 15px;">项目复盘</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/记录/" style="font-size: 15px;">记录</a> <a href="/tags/小项目/" style="font-size: 15px;">小项目</a> <a href="/tags/组件沉淀/" style="font-size: 15px;">组件沉淀</a> <a href="/tags/phaser/" style="font-size: 15px;">phaser</a> <a href="/tags/sass/" style="font-size: 15px;">sass</a> <a href="/tags/compass/" style="font-size: 15px;">compass</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/日常研究/" style="font-size: 15px;">日常研究</a> <a href="/tags/AI/" style="font-size: 15px;">AI</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/06/初识AI之设计稿楼层识别分割/">初识AI之设计稿楼层识别分割</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/23/Vue组件库之Popup弹窗组件/">vue组件库之popup弹窗组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/19/算法应用之自定义公式计算/">算法应用之自定义公式计算</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/05/记录之MAC环境下一次重新安装nvm和nrm/">记录之MAC环境下一次重新安装nvm和nrm</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/05/记录第一次typescript重构后端/">记录第一次typescript重构后端</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/27/赶鸭子上架的全栈开发踩坑思考/">赶鸭子上架的全栈开发踩坑思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/25/phaser2->3：来个打地鼠试水/">phaser2->3：来个打地鼠试水</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/14/优化动画卡顿：卡顿原因分析及优化方案/">优化动画卡顿：卡顿原因分析及优化方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/08/两周一报14（20190308）/">两周一报14（20190308）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/22/两周一报13（20190222）/">两周一报13（20190222）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Winnie Cai's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>